# Rule template for example executables.
#
# The reason why the executables depend on their dependency data file
# is to trigger the generation of their dependency data when they are updated.
# Once generated, future executions of make will include and benefit from the dependency data.
# Dependency data file generation rules are defined in .make/targets/dependencies.
#
# $(1) = path to source file
# $(2) = path to executable file
# $(3) = path to dependency data file
#
# References:
#
#     https://make.mad-scientist.net/papers/advanced-auto-dependency-generation/#depdelete
#
define example_rule_template
examples_targets += $(2)

$(2) : $(1) $(3) $$(library) $$(objects_start) $$(gcc_wrapper)
	$$(call ensure_target_directory_exists)
	$$(call gcc.compile_example,$$@,$$<,$$(linkage))
endef

# Computes the parameters for and evaluates the example rule template.
#
# $(1) = path to example source file
#
generate_example_rule = $(call example_rule_template,$(1),$(call to_executable,$(1)),$(call to_dependency,$(1)))

# Compute list of all example targets
targets += $(examples_targets)
