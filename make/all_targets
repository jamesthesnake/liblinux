# The main build targets are the static and dynamic libraries
include make/targets/static_library
include make/targets/dynamic_library

# Targets for the liblinux process startup files
include make/targets/start

# GCC wrapper script and the specs file used by it
include make/targets/gcc_wrapper

# Targets for library usage examples
include make/examples

examples_targets := $(addprefix $(build_examples_directory)/,$(examples))
targets += $(examples_targets)

$(build_examples_directory)/% : $(examples_directory)/%.c $(target) $(objects_start) $(gcc_wrapper) | directories
	$(call gcc.compile_example,$@,$<)

define generate_example_rule
phony_targets += run-$(1)
run-$(1) : $$(build_examples_directory)/$(1) | directories
	LD_LIBRARY_PATH=$$(build_libraries_directory) $$(build_examples_directory)/$(1)
endef
$(foreach phony,$(examples),$(eval $(call generate_example_rule,$(phony))))
undefine run_example_rule
