# Phony targets

phony_targets += static-library
static-library: $(static_library)

phony_targets += dynamic-library
dynamic-library: $(dynamic_library)

phony_targets += libraries
libraries: static-library dynamic-library

phony_targets += startfiles
startfiles: $(objects_start)

phony_targets += static-examples
static-examples: $(examples_static_targets)

phony_targets += dynamic-examples
dynamic-examples: $(examples_dynamic_targets)

phony_targets += examples
examples: static-examples dynamic-examples

phony_targets += all
all: libraries startfiles examples

phony_targets += clean
clean:
	rm -rf $(build_directory)

phony_targets += directories
directories:
	mkdir -p $(sort $(dir $(objects) $(targets)))

define generate_run_example_rule
phony_targets += run-$(1) run-static-$(1) run-dynamic-$(1)

run-$(1) : run-static-$(1)

run-static-$(1) : $$(build_examples_static_directory)/$(1) | directories
	$$(build_examples_static_directory)/$(1)

run-dynamic-$(1) : $$(build_examples_dynamic_directory)/$(1) | directories
	LD_LIBRARY_PATH=$$(build_libraries_directory) $$(build_examples_dynamic_directory)/$(1)
endef

$(foreach example,$(examples),$(eval $(call generate_run_example_rule,$(example))))

undefine generate_run_example_rule
